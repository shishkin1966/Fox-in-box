
**Clean Architecture version 5**
 
Пример реализации Clean Architecture при реализации приложения

При построении приложения использованы архитектурные шаблоны [VIPER](https://www.raywenderlich.com/5192-android-viper-tutorial) и [Service Locator](https://docs.microsoft.com/en-us/previous-versions/msp-n-p/ff648968(v=pandp.10)). 

Архитектура приложения реализует следующую цепочку событий:

 источник(view -> презентер) -> запрос (Action) -> провайдер -> исполнитель провайдера -> сообщение с результатом -> мессенджер -> получатель (презентер или иной объект)

Поддерживается Observable объекты в том числе:

- Объекты БД (таблицы)
- BroadcastReceiver
- Content Provider
- обычные именованные объекты

Для  провайдера Observable объектов цепочка событий представляет собой;
событие(Action) -> провайдер Observable объектов -> сообщение с результатом -> мессенджер -> получатель (презентер или иной объект)

В основе архитектуры лежит модель общественного разделения труда и парадигма функционального программирования. Все объекты делятся на генераторы сервиса и пользователей(потребителей) сервисов. Выделены следующие единицы:
- специалист(Provider) - объект, который предоставляет сервис любым пользователям(объектам) без их учета
- объекты-подписчики (ProviderSubscriber), которые регистрируются в объединениях для получения/предоставления сервиса
- малые объединения подписчиков(SmallUnion) - объект группы подписчиков(ProviderSubscriber) для получения/предоставления сервиса
- объединения подписчиков(Union) - объект группы подписчиков(ProviderSubscriber) для получения/предоставления расширенной функциональности

Регистрацию подписчиков и их объединений, а также специалистов и их взаимное связывание, отмену регистрации осуществляет сервис локатор (Service Locator).

Все объекты учитываемые сервис локатором реализуют интерфейсы IValidated и ISubscriber. 

Специалист(Provider) - объект, предоставляющий какую-либо функциональность любым объектам.  
Состав интерфейса IProvider:
- boolean isPersistent() – флаг, определяющий тип специалиста - постоянный/выгружаемый - т.е определяет разрешение операции отмены регистрации
- void onUnRegister() – событие, которое предваряет операцию отмену регистрации 
    специалиста. Используется для внутренних операций в специалисте, необходимых перед отменой регистрации
- void onRegister() – событие, которое завершает операцию регистрации специалиста
- void stop() - остановить работу специалиста

Объединение(SmallUnion или Union) подписчиков (классов, реализующие интерфейс IProviderSubscriber) учитывает подписчиков только одного типа. Интерфейс IProviderSubscriber является наследником интерфейса ISubscriber.
    
По времени жизни провайдеры делятся на:
- постоянные (или синглтоны). Время жизни - время жизни приложения. Не могут быть выгружены
- нормальные. Могут быть загружены и выгружены
- короткоживущие. Самовыгружающиеся специалисты по какому-либо признаку(например по бездействию или отсутствию подписчиков)

Наследником интерфейса IProvider является интерфейс ISmallUnion, которые объединяют подписчиков одного типа. Например Activity или презентеров.
Наследником интерфейса ISmallUnion является IUnion. В котором есть поддержка текущего подписчика. Например - текущей на экране Activity.

Как было указано, управлением специалистов и объединений занимается администратор (Service Locator), реализующий интерфейс IServiceLocator.

Регистрация провайдеров(объединений) проводиться по его имени.

Привязка и отвязка подписчиков (классов с интерфейсом IProviderSubscriber) к специалистам осуществляется ServiceLocator или самим провайдером. Если провайдер не загружен производится автоматическая создание необходимых провайдеров (объединений). Отписка подписчиков проводится сразу от всех подписанных им провайдеров. 

